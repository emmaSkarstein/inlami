---
title: "Survival data with repeated systolic blood pressure measurements"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{nhanes_survival}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(inlami)
library(INLA)
```


```{r, eval = FALSE}
surv_list <- as.list(nhanes_survival)
surv_list$surv <- INLA::inla.surv(time = nhanes_survival$t/10, event = nhanes_survival$d)

survival_stacks <- make_inlami_stacks(formula_moi = surv ~ sbp + age + smoking + sex + diabetes,
  formula_imp = sbp ~ age + smoking + sex + diabetes,
  data = surv_list,
  error_type = c("classical", "missing"),
  repeated_observations = TRUE)

survival_model <- fit_inlami(
  formula_moi = surv ~ sbp + age + smoking + sex + diabetes,
  formula_imp = sbp ~ age + smoking + sex + diabetes,
  family_moi = "weibull.surv",
  data = surv_list,
  error_type = c("classical", "missing"),
  repeated_observations = TRUE,
  control.family = list(
    list(hyper = list(alpha = list(param = prior.exp,
                                   initial = log(exp.init),
                                   fixed = FALSE))),
    list(hyper = list(prec = list(initial = log(prec.u),
                                  param = prior.prec.u,
                                  fixed = FALSE))),
    list(hyper = list(prec = list(initial = log(prec.x),
                                  param = prior.prec.x,
                                  fixed = FALSE)))),
  control.predictor=list(link=3))
```



