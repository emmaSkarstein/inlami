<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="inlami">
<title>Survival data with repeated systolic blood pressure measurements • inlami</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Survival data with repeated systolic blood pressure measurements">
<meta property="og:description" content="inlami">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">inlami</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Framingham_heart_study.html">Influence of systolic blood pressure on coronary heart disease</a>
    <a class="dropdown-item" href="../articles/Visualize_model_structure.html">How are the models structured?</a>
    <a class="dropdown-item" href="../articles/nhanes_survival.html">Survival data with repeated systolic blood pressure measurements</a>
    <a class="dropdown-item" href="../articles/simulated_examples.html">Simulated examples</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Survival data with repeated systolic blood pressure measurements</h1>
            
      
      
      <div class="d-none name"><code>nhanes_survival.Rmd</code></div>
    </div>

    
    
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical, missing values</td>
<td align="left">Weibull survival</td>
<td align="left">survival time</td>
<td align="left">
<code>sbp1</code>, <code>sbp2</code>
</td>
<td align="left">
<code>smoke</code>, <code>age</code>,
<code>diabetes</code>, <code>sex</code>
</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emmaskarstein.github.io/inlami/">inlami</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>This example shows how to fit a Weibull survival model to describe
the influence systolic blood pressure (SBP) has on survival. The model
is the same as in <a href="https://emmaskarstein.github.io/Missing-data-and-measurement-error/missing_and_mismeasured_covariate.html" class="external-link">Skarstein
et al. (2023)</a>, but just using <code>inlami</code> rather than plain
INLA.</p>
<p>We assume there to be some measurement error in the SBP measurements.
For some of the patients we have repeated measurements, but not for all,
and for some patients both of the measurements are even missing.
Therefore we are dealing with both classical measurement error and
missing data in this case.</p>
<p>For the main model of interest, we have the formula <span class="math display">\[
\eta_i = \beta_0 + \beta_{\texttt{sbp}} \texttt{sbp}_i +
\beta_{\texttt{sex}} \texttt{sex}_i + \beta_{\texttt{age}}
\texttt{age}_i + \beta_{\texttt{smoke}} \texttt{smoke}_i +
\beta_{\texttt{diabetes}} \texttt{diabetes}_i.
\]</span> The error models for the repeated SBP measurement are <span class="math display">\[
\begin{align}
\texttt{sbp}^1_i = \texttt{sbp}_i + u_i^{1}, \\
\texttt{sbp}^2_i = \texttt{sbp}_i + u_i^{2},
\end{align}
\]</span> and the imputation model for <code>sbp</code> is <span class="math display">\[
\texttt{sbp}_i = \alpha_0 + \alpha_{\texttt{sex}} \texttt{sex}_i +
\alpha_{\texttt{age}} \texttt{age}_i + \alpha_{\texttt{smoke}}
\texttt{smoke}_i + \alpha_{\texttt{diabetes}} \texttt{diabetes}_i.
\]</span> We begin by specifying the necessary priors:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Priors for measurement error variance and true x-value</span></span>
<span><span class="va">prior.prec.u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># Gamma(0.5, 0.5) (same as Keogh&amp;Bartlett)</span></span>
<span><span class="va">prior.prec.x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># Gamma(0.5, 0.5) (same as K&amp;B)</span></span>
<span><span class="va">prec.u</span> <span class="op">&lt;-</span> <span class="fl">2.8</span></span>
<span><span class="va">prec.x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Prior for shape parameter of the Weibull survival model</span></span>
<span><span class="va">prior.exp</span> <span class="op">&lt;-</span> <span class="fl">0.01</span> <span class="co"># Gamma(1, 0.001) ~ Exp(0.001) (INLA sets prior on theta, r~Exp(0.1*theta))</span></span>
<span><span class="va">exp.init</span> <span class="op">&lt;-</span> <span class="fl">1.4</span></span></code></pre></div>
<p>And then we fit the model itself. Let me point out some of the things
that are special for this model:</p>
<ul>
<li>
<strong><code><a href="https://rdrr.io/pkg/INLA/man/surv.html" class="external-link">inla.surv()</a></code>:</strong> Since we have a survival
model, the response of the model is <code>inla.surv(t, d)</code>. In
this case, <code>t</code> is the survival time, and <code>d</code> is
the censoring indicator, indicating whether the patient was still alive
at the end of the study period, or whether the patient had actually
passed away.</li>
<li>
<strong><code>control.family</code>:</strong> Another thing to note
is that since the <code>fit_inlami</code> function does not have
arguments for passing the prior for the shape parameter of the Weibull
survival model to <code>inla</code>, we instead need to write out the
whole <code>control.family</code> argument and pass this to
<code>fit_inlami</code>. If you are not used to R-INLA this may look a
bit strange, but this is simply how the priors for the three different
levels of the model are passed to <code>inla</code>. So as you can see
it is a list of three lists, and each of these layers corresponds to one
model layer, so the first one is for the main model of interest, the
second one is for the error model, and the third layer is for the
imputation model.</li>
<li>
<strong><code>repeated_observations</code>:</strong> Since we have
repeated measurements for SBP, we need to set this argument to
<code>TRUE</code>.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survival_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlami.html">fit_inlami</a></span><span class="op">(</span></span>
<span>  formula_moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/surv.html" class="external-link">inla.surv</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">d</span><span class="op">)</span> <span class="op">~</span> <span class="va">sbp</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">smoke</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">diabetes</span>,</span>
<span>  formula_imp <span class="op">=</span> <span class="va">sbp</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">smoke</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">diabetes</span>,</span>
<span>  family_moi <span class="op">=</span> <span class="st">"weibull.surv"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">nhanes_survival</span>,</span>
<span>  error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classical"</span>, <span class="st">"missing"</span><span class="op">)</span>,</span>
<span>  repeated_observations <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  control.family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Prior for main model of interest (moi)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>param <span class="op">=</span> <span class="va">prior.exp</span>,</span>
<span>                                   initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">exp.init</span><span class="op">)</span>,</span>
<span>                                   fixed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># Prior for error model</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">prec.u</span><span class="op">)</span>,</span>
<span>                                  param <span class="op">=</span> <span class="va">prior.prec.u</span>,</span>
<span>                                  fixed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># Prior for imputation model</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">prec.x</span><span class="op">)</span>,</span>
<span>                                  param <span class="op">=</span> <span class="va">prior.prec.x</span>,</span>
<span>                                  fixed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>, <span class="co"># Prior for beta.sbp</span></span>
<span>  control.predictor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>link<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co"># Why 3?</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">survival_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; inla.surv(t, d) ~ sbp + age + smoke + sex + diabetes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; sbp ~ age + smoke + sex + diabetes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "classical" "missing"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;                     mean         sd 0.025quant   0.5quant 0.975quant       mode</span></span>
<span><span class="co">#&gt; beta.0        -5.4540730 0.13790854 -5.7178475 -5.4542724 -5.1898456 -5.4542612</span></span>
<span><span class="co">#&gt; beta.age       0.9054649 0.04986825  0.8076080  0.9055093  1.0030704  0.9055103</span></span>
<span><span class="co">#&gt; beta.smoke     0.2700312 0.08453206  0.1042701  0.2700316  0.4357904  0.2700316</span></span>
<span><span class="co">#&gt; beta.sex       0.4454307 0.07880391  0.2909164  0.4454260  0.5999722  0.4454260</span></span>
<span><span class="co">#&gt; beta.diabetes  0.5919697 0.09293528  0.4096870  0.5919856  0.7741625  0.5919858</span></span>
<span><span class="co">#&gt;                        kld</span></span>
<span><span class="co">#&gt; beta.0        4.309774e-07</span></span>
<span><span class="co">#&gt; beta.age      1.626974e-09</span></span>
<span><span class="co">#&gt; beta.smoke    5.015116e-11</span></span>
<span><span class="co">#&gt; beta.sex      5.038495e-11</span></span>
<span><span class="co">#&gt; beta.diabetes 5.911015e-11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for error prone variable: </span></span>
<span><span class="co">#&gt;               mean        sd 0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; beta.sbp 0.1132243 0.0486333  0.0173987 0.1132526  0.2088857 0.1133696</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;                        mean         sd  0.025quant     0.5quant 0.975quant</span></span>
<span><span class="co">#&gt; alpha.0         0.006414743 0.04311844 -0.07814274  0.006414679 0.09097258</span></span>
<span><span class="co">#&gt; alpha.age       0.322557260 0.02956393  0.26458302  0.322556476 0.38053598</span></span>
<span><span class="co">#&gt; alpha.smoke     0.004837680 0.05062418 -0.09443970  0.004837881 0.10411391</span></span>
<span><span class="co">#&gt; alpha.sex      -0.061813670 0.04701751 -0.15401665 -0.061814006 0.03039122</span></span>
<span><span class="co">#&gt; alpha.diabetes  0.137938591 0.06224097  0.01588371  0.137937492 0.25999974</span></span>
<span><span class="co">#&gt;                        mode          kld</span></span>
<span><span class="co">#&gt; alpha.0         0.006414679 1.169931e-11</span></span>
<span><span class="co">#&gt; alpha.age       0.322556474 1.210693e-11</span></span>
<span><span class="co">#&gt; alpha.smoke     0.004837881 1.180871e-11</span></span>
<span><span class="co">#&gt; alpha.sex      -0.061814007 1.177635e-11</span></span>
<span><span class="co">#&gt; alpha.diabetes  0.137937490 1.177289e-11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.sbp): </span></span>
<span><span class="co">#&gt;                                                mean         sd 0.025quant</span></span>
<span><span class="co">#&gt; alpha parameter for weibullsurv            1.376962 0.04080048  1.2978275</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations[2] 2.838730 0.25689367  2.3577111</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations[3] 1.027330 0.04959700  0.9343125</span></span>
<span><span class="co">#&gt;                                            0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; alpha parameter for weibullsurv            1.376548   1.458456 1.376136</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations[2] 2.830219   3.368168 2.819653</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations[3] 1.025740   1.129553 1.021713</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">survival_model</span>, plot_intercepts <span class="op">=</span> <span class="cn">FALSE</span>, plot_imp <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="nhanes_survival_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emma Skarstein, Stefanie Muff.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
